<style>
  #voiceTextContainer {
    max-width: 700px;
    margin: 20px auto;
    font-size: 20px;
    line-height: 1.6;
    overflow: hidden;
    position: relative;
    height: 300px;
  }
  .speech-line {
    display: block;
    margin-bottom: 10px;
  }
  .highlight {
    background-color: #ffff99;
    transition: background 0.2s;
  }
  .word {
    transition: background 0.1s;
  }
  #controls {
    text-align: center;
    margin-top: 15px;
  }
  #controls button {
    padding: 8px 16px;
    margin: 0 5px;
    font-size: 16px;
    cursor: pointer;
  }
</style>

<div id="voiceTextContainer">
  <span class="speech-line" data-text="Want to ace your Nursing exams?"></span>
  <span class="speech-line" data-text="The Nursing Prometric Test is a simulation exam for Nurse Technicians and Nurse Specialists."></span>
  <span class="speech-line" data-text="It contains"></span>
  <span class="speech-line" data-text="500"></span>
  <span class="speech-line" data-text="questions based on the SMLE and Enclex exams, divided into Easy, Medium, and Hard levels."></span>
  <span class="speech-line" data-text="Each question comes with a detailed rationale to help you understand, learn, and improve your score."></span>
  <span class="speech-line" data-text="Take the demo test for"></span>
  <span class="speech-line" data-text="free"></span>
  <span class="speech-line" data-text="and unlock the full test with a secure code today!"></span>
</div>

<div id="controls">
  <button id="playBtn">Play</button>
  <button id="pauseBtn">Pause</button>
  <button id="restartBtn">Restart</button>
</div>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('voiceTextContainer');
  const lines = Array.from(container.querySelectorAll('.speech-line'));
  let timeoutIds = [];
  let isPaused = false;
  let currentLineIndex = 0;
  let currentWordIndex = 0;

  // Split text into word spans
  lines.forEach(line => {
    const text = line.dataset.text;
    line.innerHTML = '';
    text.split(' ').forEach(word => {
      const span = document.createElement('span');
      span.className = 'word';
      span.textContent = word + ' ';
      line.appendChild(span);
    });
  });

  const messages = [
    { text: "Want to ace your Nursing exams?", pitch: 1.2, rate: 1 },
    { text: "The Nursing Prometric Test is a simulation exam for Nurse Technicians and Nurse Specialists.", pitch: 1, rate: 1 },
    { text: "It contains", pitch: 1.1, rate: 1.1 },
    { text: "500", pitch: 1.5, rate: 0.9 },
    { text: "questions based on the SMLE and Enclex exams, divided into Easy, Medium, and Hard levels.", pitch: 1.1, rate: 1.1 },
    { text: "Each question comes with a detailed rationale to help you understand, learn, and improve your score.", pitch: 1, rate: 1 },
    { text: "Take the demo test for", pitch: 1.2, rate: 1.1 },
    { text: "free", pitch: 1.5, rate: 0.9 },
    { text: "and unlock the full test with a secure code today!", pitch: 1.2, rate: 1.1 }
  ];

  let voices = [];
  function initVoices() {
    voices = window.speechSynthesis.getVoices();
  }

  if (speechSynthesis.onvoiceschanged !== undefined) {
    speechSynthesis.onvoiceschanged = initVoices;
  } else {
    initVoices();
  }

  function speakWord(lineIdx, wordIdx) {
    if (isPaused) return;
    if (lineIdx >= lines.length) return;

    const line = lines[lineIdx];
    const words = Array.from(line.querySelectorAll('.word'));
    if (wordIdx >= words.length) {
      currentLineIndex++;
      currentWordIndex = 0;
      speakWord(currentLineIndex, currentWordIndex);
      return;
    }

    // Highlight current word
    words.forEach(w => w.classList.remove('highlight'));
    words[wordIdx].classList.add('highlight');

    // Scroll container
    container.scrollTo({ top: line.offsetTop - 20, behavior: 'smooth' });

    // Speak word
    const utter = new SpeechSynthesisUtterance(words[wordIdx].textContent.trim());
    const msg = messages[lineIdx];
    utter.voice = voices.find(v => v.lang === 'en-US' && v.name.includes('Google')) || voices[0];
    utter.lang = 'en-US';
    utter.pitch = (words[wordIdx].textContent.trim() === "500" || words[wordIdx].textContent.trim() === "free") ? 1.5 : msg.pitch;
    utter.rate = (words[wordIdx].textContent.trim() === "500" || words[wordIdx].textContent.trim() === "free") ? 0.9 : msg.rate;
    utter.volume = 1;
    window.speechSynthesis.speak(utter);

    // Schedule next word
    const delay = 350; // approx per word
    const id = setTimeout(() => {
      currentWordIndex++;
      speakWord(currentLineIndex, currentWordIndex);
    }, delay);
    timeoutIds.push(id);
  }

  function playVoice() {
    if (!isPaused) return;
    isPaused = false;
    speakWord(currentLineIndex, currentWordIndex);
  }

  function pauseVoice() {
    isPaused = true;
    window.speechSynthesis.cancel();
    timeoutIds.forEach(id => clearTimeout(id));
    timeoutIds = [];
  }

  function restartVoice() {
    pauseVoice();
    lines.forEach(line => line.querySelectorAll('.word').forEach(w => w.classList.remove('highlight')));
    currentLineIndex = 0;
    currentWordIndex = 0;
    isPaused = false;
    speakWord(currentLineIndex, currentWordIndex);
  }

  // Controls
  document.getElementById('playBtn').addEventListener('click', () => {
    if (window.speechSynthesis.speaking) return; // already speaking
    speakWord(currentLineIndex, currentWordIndex);
  });
  document.getElementById('pauseBtn').addEventListener('click', pauseVoice);
  document.getElementById('restartBtn').addEventListener('click', restartVoice);

  // Auto-start
  speakWord(currentLineIndex, currentWordIndex);
});
</script>
